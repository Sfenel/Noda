<!DOCTYPE html><html lang=en><head><meta charset=UTF-8><meta content="width=device-width,initial-scale=1"name=viewport><title>Noda</title><link href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css rel=stylesheet><link href=Noda-logo.png rel=icon></head><body><style>:root{--essence-gradient:linear-gradient(to bottom right, #00ffff, #8a2be2);--blaze-gradient:linear-gradient(to bottom right, #ffd700, #ff4500);--frost-gradient:linear-gradient(to bottom right, #00ffff, #90ee90);--obsidian-gradient:linear-gradient(to bottom right, #ff00ff, #8a2be2);--stasis-gradient:linear-gradient(to bottom right, cyan, #FF69B4);--current-gradient:var(--essence-gradient);--handle-color:#fff}body{margin:0;overflow:hidden;font-family:sans-serif;background-color:#0a0a0a;color:#eee;transition:background-color 0.3s ease}body.light-mode{background-color:#f0f0f0;color:#333;--handle-color:#333}#canvas{width:15000px;height:15000px;background-color:#111;position:relative;overflow:hidden;cursor:grab;transition:background-color 0.3s ease;background-image:radial-gradient(rgb(255 255 255 / .05) 1px,transparent 1px);background-size:20px 20px}#canvas:active{cursor:grabbing}#canvas.light-mode{background-color:#ddd;background-image:radial-gradient(rgb(0 0 0 / .1) 1px,transparent 1px);background-size:20px 20px}#mouse-glow{position:absolute;width:400px;height:400px;border-radius:50%;background:radial-gradient(circle,rgb(255 255 255 / .03),transparent 70%);pointer-events:none;z-index:0;transform:translate(-50%,-50%);transition:opacity 0.3s ease,background 0.3s ease;opacity:0}#mouse-glow.visible{opacity:1}#mouse-glow.light-mode{background:radial-gradient(circle,rgb(0 0 0 / .1),transparent 70%)}.node{position:absolute;border:3px solid;border-image:var(--current-gradient) 1;box-sizing:border-box;min-width:50px;min-height:50px;border-radius:10px;box-shadow:0 0 10px rgb(255 255 255 / .5);background-color:rgb(0 0 0 / .5);transition:box-shadow 0.3s ease,transform 0.2s ease;animation:pop-in 0.2s ease}.node:hover{box-shadow:0 0 20px rgb(255 255 255 / .5)}.light-mode .node{box-shadow:0 0 10px rgb(0 0 0 / .5);background-color:rgb(255 255 255 / .8)}.light-mode .node:hover{box-shadow:0 0 20px rgb(0 0 0 / .5)}.node.deleted{animation:pop-out 0.2s ease forwards}.image-node{position:absolute;border:3px solid;border-image:var(--current-gradient) 1;box-sizing:border-box;min-width:50px;min-height:50px;border-radius:10px;box-shadow:0 0 10px rgb(255 255 255 / .5);background-color:#fff0;transition:box-shadow 0.3s ease,transform 0.2s ease;width:256px;height:256px;animation:pop-in 0.2s ease}.image-node:hover{box-shadow:0 0 20px rgb(255 255 255 / .5)}.light-mode .image-node{box-shadow:0 0 10px rgb(0 0 0 / .5)}.light-mode .image-node:hover{box-shadow:0 0 20px rgb(0 0 0 / .5)}.image-node.deleted{animation:pop-out 0.2s ease forwards}.node .handle{position:absolute;top:0;left:0;width:100%;height:20px;cursor:move;z-index:1;background-color:#fff0;color:var(--handle-color)}.image-node .handle{position:absolute;top:0;left:0;width:100%;height:100%;cursor:move;z-index:1;background-color:#fff0;color:var(--handle-color)}.node textarea{width:100%;height:100%;border:none;outline:none;resize:none;padding:5px;box-sizing:border-box;font-family:inherit;font-size:14px;background-color:#fff0;color:inherit}.node .resize-handle,.image-node .resize-handle{position:absolute;bottom:0;right:0;width:10px;height:10px;background-color:#888;cursor:nwse-resize;border-radius:0 0 10px 0;z-index:2}.image-node img{width:100%;height:100%;object-fit:contain;border-radius:7px;display:block}.context-menu{position:absolute;background-color:#333;border:1px solid #555;border-radius:5px;box-shadow:0 2px 5px rgb(0 0 0 / .3);display:none;z-index:1000;transition:background-color 0.3s ease;display:flex;flex-direction:row;align-items:center;padding:5px}.context-menu.light-mode{background-color:#ddd;border:1px solid #999}.context-menu-option{padding:8px;cursor:pointer;color:#eee;transition:background-color 0.3s ease,color 0.3s;display:flex;justify-content:center;align-items:center;border-radius:5px;margin:0 5px}.context-menu-option i{font-size:1.2em}.light-mode .context-menu-option{color:#333}.context-menu-option:hover{background-color:#444}.light-mode .context-menu-option:hover{background-color:#ccc}.settings-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgb(0 0 0 / .7);backdrop-filter:blur(5px);z-index:2000;display:none;align-items:center;justify-content:center}.settings-menu{background-color:#222;border:1px solid #444;border-radius:8px;padding:20px;box-shadow:0 4px 8px rgb(0 0 0 / .5);max-width:600px;width:90%;transition:background-color 0.3s ease;display:grid;grid-template-columns:repeat(2,1fr);gap:15px 20px;position:relative}.settings-menu.light-mode{background-color:#eee}.setting{margin-bottom:0;display:flex;flex-direction:column;align-items:flex-start;justify-content:flex-start}.setting label{margin-right:10px;color:#eee;transition:color 0.3s ease;margin-bottom:5px}.light-mode .setting label{color:#333}.setting input[type="checkbox"],.setting select,.setting button{padding:5px;border-radius:3px;border:none;background-color:#444;color:#eee;cursor:pointer;transition:background-color 0.3s ease}.setting button:hover{background-color:#555}.light-mode .setting button{background-color:#ddd;color:#333}.light-mode .setting button:hover{background-color:#ccc}.icon-buttons{display:flex;gap:10px;align-items:center}.icon-button{background-color:#444;color:#eee;border:none;border-radius:5px;padding:8px;cursor:pointer;font-size:1em;transition:background-color 0.3s ease,color 0.3s,transform 0.2s ease}.icon-button.light-mode{background-color:#ddd;color:#333}.icon-button:hover{background-color:#555;transform:scale(1.1)}.icon-button.light-mode:hover{background-color:#ccc;transform:scale(1.1)}.icon-button.active{background-color:#555}.icon-button.light-mode.active{background-color:#ccc}.bottom-button{position:absolute;background-color:rgb(0 0 0 / .5);color:#fff;border:none;border-radius:5px;padding:8px 12px;cursor:pointer;z-index:100;transition:background-color 0.3s ease,transform 0.2s ease}.bottom-button.light-mode{background-color:rgb(255 255 255 / .8);color:#000}.bottom-button:hover,.settings-close-button:hover,.help-close-button:hover{background-color:rgb(0 0 0 / .7);transform:scale(1.05)}.bottom-button.light-mode:hover,.help-close-button.light-mode:hover{background-color:rgb(255 255 255);transform:scale(1.05)}#settings-button{bottom:10px;right:10px}#help-button{bottom:10px;left:10px}.settings-close-button,.help-close-button{background-color:rgb(0 0 0 / .5);color:#fff;border:none;border-radius:5px;padding:6px 8px;cursor:pointer;transition:background-color 0.3s ease,transform 0.2s ease;position:absolute;top:10px;right:10px;font-size:1em;display:flex;justify-content:center;align-items:center;width:25px;height:25px;line-height:1}.settings-close-button.light-mode,.help-close-button.light-mode{background-color:rgb(255 255 255 / .8);color:#000}#reset-canvas-button{background-color:#dc3545;color:#fff}#reset-canvas-button:hover{background-color:#c82333}.light-mode #reset-canvas-button{color:#000}.light-mode #reset-canvas-button:hover{background-color:#f8d7da}@keyframes pop-in{0%{transform:scale(.5);opacity:0}100%{transform:scale(1);opacity:1}}@keyframes pop-out{0%{transform:scale(1);opacity:1}100%{transform:scale(.5);opacity:0}}.node-image-option{display:none}#url-input{position:absolute;z-index:1001;background-color:#444;border:1px solid #666;border-radius:4px;padding:3px 5px;font-size:12px;color:#eee;display:none;box-shadow:0 2px 5px rgb(0 0 0 / .3)}.light-mode #url-input{background-color:#ddd;color:#333;border:1px solid #999}.settings-menu{padding:25px}.setting{margin-bottom:20px}.setting label{font-size:1.1em;margin-bottom:8px;display:block}.setting button,.setting select,.setting input[type="checkbox"]{padding:8px;font-size:1em}#canvas-dock{position:fixed;top:10px;left:50%;transform:translateX(-50%);background-color:rgb(0 0 0 / .3);backdrop-filter:blur(10px);padding:8px 15px;border-radius:8px;display:flex;align-items:center;gap:10px;z-index:100;transition:background-color 0.3s ease;box-shadow:0 2px 4px rgb(0 0 0 / .2)}#canvas-dock.light-mode{background-color:rgb(255 255 255 / .5);backdrop-filter:blur(8px);box-shadow:0 2px 4px rgb(0 0 0 / .1)}#canvas-dropdown{background-color:rgb(68 68 68 / .7);color:#eee;border:none;border-radius:5px;padding:8px;cursor:pointer;transition:background-color 0.3s ease,color 0.3s,transform 0.2s ease}#canvas-dropdown.light-mode{background-color:rgb(221 221 221 / .7);color:#333}#canvas-dropdown:hover,.canvas-action-button:hover{background-color:rgb(85 85 85 / .8);transform:scale(1.03)}#canvas-dropdown.light-mode:hover,.canvas-action-button.light-mode:hover{background-color:rgb(204 204 204 / .8);transform:scale(1.03)}.canvas-action-button{background-color:rgb(68 68 68 / .7);color:#eee;border:none;border-radius:5px;padding:8px 12px;cursor:pointer;font-size:1em;transition:background-color 0.3s ease,color 0.3s,transform 0.2s ease;display:flex;align-items:center;justify-content:center;gap:8px}.canvas-action-button.light-mode{background-color:rgb(221 221 221 / .7);color:#333}#rename-canvas-input{background-color:rgb(68 68 68 / .7);color:#eee;border:none;border-radius:5px;padding:8px;margin-left:5px;display:none;transition:background-color 0.3s ease,color 0.3s}#rename-canvas-input.light-mode{background-color:rgb(221 221 221 / .7);color:#333}#confirmation-menu{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background-color:#333;color:#eee;border:1px solid #555;border-radius:8px;padding:20px;box-shadow:0 4px 8px rgb(0 0 0 / .5);z-index:3000;display:none;flex-direction:column;gap:15px;align-items:center;transition:background-color 0.3s ease,color 0.3s ease}#confirmation-menu.light-mode{background-color:#ddd;color:#333;border:1px solid #999}#confirmation-message{font-size:1.1em;text-align:center}.confirmation-buttons{display:flex;gap:10px}.confirmation-button{padding:8px 15px;border:none;border-radius:5px;cursor:pointer;transition:background-color 0.3s ease,color 0.3s ease}.confirm-button{background-color:#5cb85c;color:#fff}.confirm-button.light-mode{color:#000}.confirm-button:hover{background-color:#4cae4c}.confirm-button.light-mode:hover{background-color:#c0e0c0}.cancel-button{background-color:#dc3545;color:#fff}.cancel-button.light-mode{color:#000}.cancel-button:hover{background-color:#c82333}.cancel-button.light-mode:hover{background-color:#f8d7da}.help-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgb(0 0 0 / .7);backdrop-filter:blur(5px);z-index:2100;display:none;align-items:center;justify-content:center}.help-menu{background-color:#222;border:1px solid #444;border-radius:8px;padding:20px;box-shadow:0 4px 8px rgb(0 0 0 / .5);max-width:800px;width:90%;transition:background-color 0.3s ease;position:relative;color:#eee;overflow-y:auto;max-height:80vh}.help-menu.light-mode{background-color:#eee;color:#333}.help-menu h2,.help-menu h3{color:#eee;margin-top:15px;margin-bottom:10px}.help-menu.light-mode h2,.help-menu.light-mode h3{color:#333}.help-menu p,.help-menu li{line-height:1.6;margin-bottom:8px}.help-menu ul{padding-left:20px}#disclaimer{opacity:.3;font-size:11px}#loading-screen{position:fixed;top:0;left:0;width:100%;height:100%;background-color:#0a0a0a;z-index:9999;display:flex;justify-content:center;align-items:center;transition:opacity 1s ease}#loading-screen.light-mode{background-color:#f0f0f0}.loading-spinner{border:4px solid rgb(255 255 255 / .3);border-top:4px solid #fff;border-radius:50%;width:50px;height:50px;animation:spin 1s linear infinite}#loading-screen.light-mode .loading-spinner{border:4px solid rgb(0 0 0 / .3);border-top:4px solid #333}@keyframes spin{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}</style><div id=loading-screen><div class=loading-spinner></div></div><div id=canvas-dock><select id=canvas-dropdown></select> <button class=canvas-action-button id=rename-canvas-button title="Rename Canvas"><i class="fas fa-pencil-alt"></i></button> <input id=rename-canvas-input style=display:none placeholder="New canvas name"> <button class=canvas-action-button id=new-canvas-button title="New Canvas"><i class="fas fa-plus"></i></button> <button class=canvas-action-button id=delete-canvas-button title="Delete Canvas"><i class="fas fa-trash-alt"></i></button></div><div id=confirmation-menu><div id=confirmation-message></div><div class=confirmation-buttons><button class="confirmation-button confirm-button"id=confirm-action-button>Confirm</button> <button class="confirmation-button cancel-button"id=cancel-action-button>Cancel</button></div></div><div class=help-overlay id=help-overlay><div class=help-menu id=help-menu><button class=help-close-button id=close-help-button><i class="fas fa-times"></i></button><h1>Help</h1><p>Noda is a visual note-taking application that allows you to create and organize your thoughts and ideas on a (nearly) infinite canvas. This guide will briefly go over the features and limitations of Noda.<h3>Nodes</h3><p>Nodes are Noda's version of notes. They can be used to store text and image information anywhere on the canvas. To create a node, right click the canvas and hit the <i class="fas fa-plus"></i> icon. Nodes can be moved using the handle at the top, and resized using the handle at the bottom right. To add images, use <i class="fas fa-clipboard"></i> to paste from clipboard, <i class="fas fa-folder-open"></i> to upload image from file, and <i class="fas fa-paperclip"></i> to insert an image from URL. Adding an image to a node will replace that node completely, removing text you may have there. It is recommended to add images to blank nodes only. Nodes can be deleted using the <i class="fas fa-trash-alt"></i> button, and duplicated using the <i class="fas fa-clone"></i> button.<h3>Canvas Navigation</h3><p>Left click and drag the canvas to pan. Use ctrl + and ctrl - to zoom in and out (browser built-in feature). Press the <i class="fas fa-home"></i> button in the right click menu to recenter the canvas. The canvas has a size of about 225 million square pixels, not quite infinite but good enough.<h3>Multiple Canvases</h3><p>There is a dock at the top center of the screen you can use to create and access multiple different canvases. Use the dropdown to select between existing canvases, and the buttons to the right of the dropdown to rename, create, or delete entire canvases.<h3>Settings</h3><p>Pressing the <i class="fas fa-cog"></i> icon in the bottom right will open the settings menu. From here you can personalize Noda to your liking. You can toggle dark/light mode, enable or disable grid snap, and adjust color schemes of node borders. Also, you can backup your canvases to file using the export and import buttons. Your canvases will autosave every 5s, but browser local storage can be a bit of a pain sometimes. You also have the option here to reset the current canvas.<h3>Offline Usage</h3><p>If you would like to install Noda locally for offline usage, the code can be downloaded from <a href="https://github.com/Sfenel/Noda" target="_blank">here</a>.</p><p id=disclaimer>(If this help menu seems very monotone as far as tone goes, I am very tired writing this, give me a break)</div></div><div id=canvas><div id=mouse-glow></div></div><div class=context-menu id=context-menu><div class=context-menu-option id=create-node-option title="Create Node"><i class="fas fa-plus"></i></div><div class=context-menu-option id=center-canvas-option title="Center Canvas"><i class="fas fa-home"></i></div><div class=context-menu-option id=duplicate-node-option title="Duplicate Node"><i class="fas fa-clone"></i></div><div class=context-menu-option id=delete-node-option title="Delete Node"><i class="fas fa-trash-alt"></i></div><div class="context-menu-option node-image-option"id=paste-image-node-option title="Paste Image"><i class="fas fa-clipboard"></i></div><div class="context-menu-option node-image-option"id=image-from-file-option title="Image from File"><i class="fas fa-folder-open"></i></div><div class="context-menu-option node-image-option"id=image-from-url-option title="Image from URL"><i class="fas fa-paperclip"></i></div><div class=context-menu-option id=cancel-option title=Cancel><i class="fas fa-times"></i></div></div><input id=file-input style=display:none type=file> <input id=url-input style=display:none placeholder="Enter image URL"> <input id=import-input style=display:none type=file><div class=settings-overlay id=settings-overlay><div class=settings-menu id=settings-menu><button class=settings-close-button id=close-settings-button><i class="fas fa-times"></i></button><h2>Settings</h2><div class=setting><label for=theme-select>Colors</label> <select id=theme-select><option value=simple>Simple<option value=blaze>Blaze<option value=essence>Essence<option value=frost>Frost<option value=obsidian>Obsidian<option value=stasis>Stasis</select></div><div class=setting><label>Theme</label><div class=icon-buttons><button class="icon-button active"id=light-mode-button title="Light Mode"><i class="fas fa-sun"></i></button> <button class=icon-button id=dark-mode-button title="Dark Mode"><i class="fas fa-moon"></i></button></div></div><div class=setting><label>Export/Import</label><div class=icon-buttons><button class=icon-button id=export-button title="Export Canvas"><i class="fas fa-paperclip"></i></button> <button class=icon-button id=import-button title="Import Canvas"><i class="fas fa-folder-open"></i></button></div></div><div class=setting><label>Grid Snap</label><div class=icon-buttons><button class=icon-button id=grid-snap-off-button title="Free Placement"><i class="fas fa-tint"></i></button> <button class="icon-button active"id=grid-snap-on-button title="Snap to Grid"><i class="fas fa-magnet"></i></button></div></div><div class=setting><button class=settings-button id=reset-canvas-button>Reset Canvas</button> <span id=reset-confirm-text style=display:none;color:red>Click <span id=reset-count>10</span> more times to confirm</span></div></div></div><button class=bottom-button id=settings-button><i class="fas fa-cog"></i></button> <button class=bottom-button id=help-button><i class="fas fa-question-circle"></i></button><script>const loadingScreen=document.getElementById('loading-screen');const canvas=document.getElementById('canvas');const contextMenu=document.getElementById('context-menu');const createNodeOption=document.getElementById('create-node-option');const duplicateNodeOption=document.getElementById('duplicate-node-option');const deleteNodeOption=document.getElementById('delete-node-option');const cancelOption=document.getElementById('cancel-option');const fileInput=document.getElementById('file-input');const mouseGlow=document.getElementById('mouse-glow');const settingsButton=document.getElementById('settings-button');const settingsOverlay=document.getElementById('settings-overlay');const settingsMenu=document.getElementById('settings-menu');const closeSettingsButton=document.getElementById('close-settings-button');const imageFromFileOption=document.getElementById('image-from-file-option');const imageFromUrlOption=document.getElementById('image-from-url-option');const pasteImageNodeOption=document.getElementById('paste-image-node-option');const urlInput=document.getElementById('url-input');const resetButton=document.getElementById('reset-button');const resetCanvasButton=document.getElementById('reset-canvas-button');const resetConfirmText=document.getElementById('reset-confirm-text');const resetCountSpan=document.getElementById('reset-count');const exportButton=document.getElementById('export-button');const importButton=document.getElementById('import-button');const importInput=document.getElementById('import-input');const themeSelect=document.getElementById('theme-select');const centerCanvasOption=document.getElementById('center-canvas-option');const lightModeButton=document.getElementById('light-mode-button');const darkModeButton=document.getElementById('dark-mode-button');const gridSnapOnButton=document.getElementById('grid-snap-on-button');const gridSnapOffButton=document.getElementById('grid-snap-off-button');const canvasDropdown=document.getElementById('canvas-dropdown');const renameCanvasButton=document.getElementById('rename-canvas-button');const newCanvasButton=document.getElementById('new-canvas-button');const deleteCanvasButton=document.getElementById('delete-canvas-button');const canvasDock=document.getElementById('canvas-dock');const renameCanvasInput=document.getElementById('rename-canvas-input');const confirmationMenu=document.getElementById('confirmation-menu');const confirmationMessage=document.getElementById('confirmation-message');const confirmActionButton=document.getElementById('confirm-action-button');const cancelActionButton=document.getElementById('cancel-action-button');let currentConfirmationCallback=null;let currentCancelCallback=null;const helpButton=document.getElementById('help-button');const helpOverlay=document.getElementById('help-overlay');const helpMenu=document.getElementById('help-menu');const closeHelpButton=document.getElementById('close-help-button');let isDragging=!1;let isResizing=!1;let currentTarget=null;let offsetX,offsetY;let startX,startY,startWidth,startHeight;let rightClickedNode=null;let isCanvasPanning=!1;let canvasOffsetX=0;let canvasOffsetY=0;let panningStartX,panningStartY;let resetConfirmClicks=0;let autoSaveInterval;let canvasWidth=15000;let canvasHeight=15000;let isDarkMode=!1;let isGridSnap=!0;let currentCanvasName='';const CANVAS_STORAGE_KEY='nodularNotesCanvases';createNodeOption.addEventListener('click',()=>{createNode(contextMenu.offsetLeft-canvasOffsetX,contextMenu.offsetTop-canvasOffsetY);hideContextMenu();saveCanvasState(currentCanvasName)});centerCanvasOption.addEventListener('click',()=>{centerCanvas();hideContextMenu();saveCanvasState(currentCanvasName)});duplicateNodeOption.addEventListener('click',()=>{if(rightClickedNode){duplicateNode(rightClickedNode)}hideContextMenu();saveCanvasState(currentCanvasName)});deleteNodeOption.addEventListener('click',()=>{if(rightClickedNode){rightClickedNode.classList.add('deleted');const nodeIdToDelete=rightClickedNode.id;setTimeout(()=>{rightClickedNode.remove();saveCanvasState(currentCanvasName);removeNodeFromState(currentCanvasName,nodeIdToDelete)},200)}hideContextMenu()});cancelOption.addEventListener('click',()=>{hideContextMenu()});imageFromFileOption.addEventListener('click',()=>{fileInput.click();hideContextMenu()});fileInput.addEventListener('change',(event)=>{const file=event.target.files[0];if(file&&rightClickedNode){const reader=new FileReader();reader.onload=(e)=>{replaceNodeWithImage(rightClickedNode,e.target.result)};reader.readAsDataURL(file)}});pasteImageNodeOption.addEventListener('click',()=>{navigator.clipboard.read().then(clipboardItems=>{for(const clipboardItem of clipboardItems){for(const type of clipboardItem.types){if(type==="image/png"||type==="image/jpeg"||type==="image/gif"){clipboardItem.getType(type).then(blob=>{replaceNodeWithImage(rightClickedNode,URL.createObjectURL(blob))})}}}}).catch(err=>{console.error("Failed to read clipboard contents: ",err);alert("Failed to read image from clipboard.  Make sure you have copied an image.")});hideContextMenu()});imageFromUrlOption.addEventListener('click',(event)=>{hideContextMenu();showUrlInput(event.clientX+5,event.clientY-5);urlInput.onkeydown=(event)=>{if(event.key==='Enter'){replaceNodeWithImage(rightClickedNode,urlInput.value);hideUrlInput()}}});function showUrlInput(x,y){urlInput.style.display='inline-block';urlInput.style.left=`${x}px`;urlInput.style.top=`${y}px`;urlInput.focus()}function hideUrlInput(){urlInput.style.display='none';urlInput.value=''}function createNode(x,y,loadedState=null){const node=document.createElement('div');node.classList.add('node');if(!isDarkMode){node.classList.add('light-mode')}const handle=document.createElement('div');handle.classList.add('handle');node.appendChild(handle);const textarea=document.createElement('textarea');node.appendChild(textarea);const resizeHandle=document.createElement('div');resizeHandle.classList.add('resize-handle');node.appendChild(resizeHandle);if(loadedState){node.id=loadedState.id;node.style.left=`${loadedState.left}px`;node.style.top=`${loadedState.top}px`;node.style.width=`${loadedState.width}px`;node.style.height=`${loadedState.height}px`;textarea.value=loadedState.text}else{node.id=`node-${Date.now()}`;node.style.left=`${x}px`;node.style.top=`${y}px`}canvas.appendChild(node);textarea.focus();return node}function createImageNode(x,y,imageUrl,loadedState=null){const node=document.createElement('div');node.classList.add('node','image-node');if(!isDarkMode){node.classList.add('light-mode')}const handle=document.createElement('div');handle.classList.add('handle');node.appendChild(handle);const img=document.createElement('img');img.src=imageUrl;img.alt='User Image';node.appendChild(img);const resizeHandle=document.createElement('div');resizeHandle.classList.add('resize-handle');node.appendChild(resizeHandle);if(loadedState){node.id=loadedState.id;node.style.left=`${loadedState.left}px`;node.style.top=`${loadedState.top}px`;node.style.width=`${loadedState.width}px`;node.style.height=`${loadedState.height}px`}else{node.id=`node-${Date.now()}`;node.style.left=`${x}px`;node.style.top=`${y}px`}canvas.appendChild(node);img.onload=()=>{const aspectRatio=img.naturalWidth/img.naturalHeight;node.dataset.aspectRatio=aspectRatio;if(!loadedState){node.style.width='256px';node.style.height=`${256/ aspectRatio}px`}};return node}function replaceNodeWithImage(textNode,imageUrl){if(!textNode)return;const rect=textNode.getBoundingClientRect();const viewportX=rect.left+window.scrollX;const viewportY=rect.top+window.scrollY;const canvasX=viewportX-canvasOffsetX;const canvasY=viewportY-canvasOffsetY;const width=textNode.offsetWidth;const height=textNode.offsetHeight;const imageNode=createImageNode(canvasX,canvasY,imageUrl);imageNode.style.width=`${width}px`;imageNode.style.height=`${height}px`;textNode.classList.add('deleted');setTimeout(()=>{textNode.remove()},200);saveCanvasState(currentCanvasName)}function duplicateNode(originalNode){if(!originalNode)return;const rect=originalNode.getBoundingClientRect();const x=rect.left+window.scrollX+20;const y=rect.top+window.scrollY+20;if(originalNode.classList.contains('image-node')){const imageUrl=originalNode.querySelector('img').src;createImageNode(x-canvasOffsetX,y-canvasOffsetY,imageUrl)}else{const text=originalNode.querySelector('textarea').value;const newNode=createNode(x-canvasOffsetX,y-canvasOffsetY);newNode.querySelector('textarea').value=text;newNode.style.width=`${originalNode.offsetWidth}px`;newNode.style.height=`${originalNode.offsetHeight}px`}saveCanvasState(currentCanvasName)}canvas.addEventListener('contextmenu',(event)=>{event.preventDefault();hideContextMenu();rightClickedNode=event.target.closest('.node');const clickX=event.clientX;const clickY=event.clientY;createNodeOption.style.display=!rightClickedNode?'inline-flex':'none';centerCanvasOption.style.display=!rightClickedNode?'inline-flex':'none';duplicateNodeOption.style.display=rightClickedNode?'inline-flex':'none';deleteNodeOption.style.display=rightClickedNode?'inline-flex':'none';cancelOption.style.display='inline-flex';imageFromFileOption.style.display=rightClickedNode&&!rightClickedNode.classList.contains('image-node')?'inline-flex':'none';imageFromUrlOption.style.display=rightClickedNode&&!rightClickedNode.classList.contains('image-node')?'inline-flex':'none';pasteImageNodeOption.style.display=rightClickedNode&&!rightClickedNode.classList.contains('image-node')?'inline-flex':'none';showContextMenu(clickX,clickY)});function showContextMenu(x,y){contextMenu.style.display='flex';contextMenu.style.left=`${x}px`;contextMenu.style.top=`${y}px`;if(!isDarkMode){contextMenu.classList.add('light-mode')}else{contextMenu.classList.remove('light-mode')}}function hideContextMenu(){contextMenu.style.display='none'}document.addEventListener('click',(event)=>{if(!event.target.closest('.context-menu')&&!event.target.closest('.node')&&!event.target.closest('#canvas-dock')&&!event.target.closest('#settings-button')&&!event.target.closest('#help-button')&&!event.target.closest('#settings-overlay')&&!event.target.closest('#help-overlay')){hideContextMenu()}});document.addEventListener('mousemove',(event)=>{mouseGlow.style.left=`${event.clientX - canvasOffsetX}px`;mouseGlow.style.top=`${event.clientY - canvasOffsetY}px`;mouseGlow.classList.add('visible');if(!isDarkMode){mouseGlow.classList.add('light-mode')}else{mouseGlow.classList.remove('light-mode')}if(isCanvasPanning){const deltaX=panningStartX-event.clientX;const deltaY=panningStartY-event.clientY;canvasOffsetX-=deltaX;canvasOffsetY-=deltaY;const maxX=0;const maxY=0;const minX=-(canvasWidth-window.innerWidth);const minY=-(canvasHeight-window.innerHeight);canvasOffsetX=Math.max(minX,Math.min(maxX,canvasOffsetX));canvasOffsetY=Math.max(minY,Math.min(maxY,canvasOffsetY));canvas.style.transform=`translate(${canvasOffsetX}px, ${canvasOffsetY}px)`;panningStartX=event.clientX;panningStartY=event.clientY}else if(isDragging){let targetNode=currentTarget;let xPos=event.clientX-offsetX;let yPos=event.clientY-offsetY;if(isGridSnap){const gridSize=20;xPos=Math.round(xPos/gridSize)*gridSize;yPos=Math.round(yPos/gridSize)*gridSize}targetNode.style.left=`${xPos}px`;targetNode.style.top=`${yPos}px`}else if(isResizing){let targetNode=currentTarget;let newWidth,newHeight;let widthChange=startX-event.clientX;let heightChange=startY-event.clientY;if(targetNode.dataset.aspectRatio){const aspectRatio=parseFloat(targetNode.dataset.aspectRatio);newWidth=startWidth-widthChange;newHeight=newWidth/aspectRatio}else{newWidth=startWidth-widthChange;newHeight=startHeight-heightChange}if(isGridSnap){const gridSize=20;newWidth=Math.round(newWidth/gridSize)*gridSize;newHeight=Math.round(newHeight/gridSize)*gridSize}targetNode.style.width=`${newWidth}px`;targetNode.style.height=`${newHeight}px`}});document.addEventListener('mouseleave',()=>{mouseGlow.classList.remove('visible')});canvas.addEventListener('mousedown',(event)=>{if(event.target===canvas){isCanvasPanning=!0;panningStartX=event.clientX;panningStartY=event.clientY}else if(event.target.classList.contains('handle')||event.target.classList.contains('resize-handle')){hideContextMenu()}if(event.target.classList.contains('handle')){isDragging=!0;currentTarget=event.target.parentNode;offsetX=event.clientX-currentTarget.offsetLeft;offsetY=event.clientY-currentTarget.offsetTop}else if(event.target.classList.contains('resize-handle')){isResizing=!0;currentTarget=event.target.parentNode;startX=event.clientX;startY=event.clientY;startWidth=currentTarget.offsetWidth;startHeight=currentTarget.offsetHeight}});document.addEventListener('mouseup',()=>{isDragging=!1;isResizing=!1;isCanvasPanning=!1;currentTarget=null;saveCanvasState(currentCanvasName)});document.addEventListener('touchstart',(event)=>{if(event.target.closest('.node')){event.preventDefault()}},{passive:!1});settingsButton.addEventListener('click',()=>{settingsOverlay.style.display='flex';if(!isDarkMode){settingsOverlay.classList.add('light-mode');settingsMenu.classList.add('light-mode')}else{settingsOverlay.classList.remove('light-mode');settingsMenu.classList.remove('light-mode')}});closeSettingsButton.addEventListener('click',()=>{settingsOverlay.style.display='none';resetConfirmText.style.display='none';resetConfirmClicks=0;resetCountSpan.textContent='10'});helpButton.addEventListener('click',()=>{helpOverlay.style.display='flex';if(!isDarkMode){helpOverlay.classList.add('light-mode');helpMenu.classList.add('light-mode')}else{helpOverlay.classList.remove('light-mode');helpMenu.classList.remove('light-mode')}});closeHelpButton.addEventListener('click',()=>{helpOverlay.style.display='none'});lightModeButton.addEventListener('click',()=>{setDarkMode(!1)});darkModeButton.addEventListener('click',()=>{setDarkMode(!0)});function setDarkMode(darkMode){isDarkMode=darkMode;document.body.classList.toggle('light-mode',!isDarkMode);document.getElementById("canvas").classList.toggle('light-mode',!isDarkMode);document.getElementById("canvas-dock").classList.toggle('light-mode',!isDarkMode);document.getElementById("canvas-dropdown").classList.toggle('light-mode',!isDarkMode);document.getElementById("rename-canvas-input").classList.toggle('light-mode',!isDarkMode);document.querySelectorAll(".node").forEach(x=>x.classList.toggle('light-mode',!isDarkMode));document.querySelectorAll(".image-node").forEach(x=>x.classList.toggle('light-mode',!isDarkMode));document.querySelectorAll(".context-menu").forEach(x=>x.classList.toggle('light-mode',!isDarkMode));document.querySelectorAll(".context-menu-option").forEach(x=>x.classList.toggle('light-mode',!isDarkMode));document.getElementById("settings-menu").classList.toggle('light-mode',!isDarkMode);document.querySelectorAll(".bottom-button").forEach(x=>x.classList.toggle('light-mode',!isDarkMode));document.querySelectorAll(".settings-close-button").forEach(x=>x.classList.toggle('light-mode',!isDarkMode));document.querySelectorAll(".help-close-button").forEach(x=>x.classList.toggle('light-mode',!isDarkMode));document.querySelectorAll(".setting").forEach(x=>x.classList.toggle('light-mode',!isDarkMode));document.querySelectorAll("label").forEach(x=>x.classList.toggle('light-mode',!isDarkMode));document.querySelectorAll("#url-input").forEach(x=>x.classList.toggle('light-mode',!isDarkMode));document.querySelectorAll(".canvas-action-button").forEach(x=>x.classList.toggle('light-mode',!isDarkMode));document.getElementById("help-menu").classList.toggle('light-mode',!isDarkMode);document.getElementById("loading-screen").classList.toggle('light-mode',!isDarkMode);lightModeButton.classList.toggle('active',!isDarkMode);darkModeButton.classList.toggle('active',isDarkMode);if(!isDarkMode){lightModeButton.classList.add('light-mode');darkModeButton.classList.add('light-mode');loadingScreen.classList.add('light-mode')}else{lightModeButton.classList.remove('light-mode');darkModeButton.classList.remove('light-mode');loadingScreen.classList.remove('light-mode')}saveCanvasState(currentCanvasName)}themeSelect.addEventListener('change',()=>{const selectedTheme=themeSelect.value;let gradient;switch(selectedTheme){case 'blaze':gradient='var(--blaze-gradient)';break;case 'frost':gradient='var(--frost-gradient)';break;case 'obsidian':gradient='var(--obsidian-gradient)';break;case 'simple':gradient='none';break;case 'stasis':gradient='var(--stasis-gradient)';break;case 'essence':default:gradient='var(--essence-gradient)'}document.documentElement.style.setProperty('--current-gradient',gradient);saveCanvasState(currentCanvasName)});resetCanvasButton.addEventListener('click',()=>{resetConfirmClicks++;if(resetConfirmClicks<10){resetConfirmText.style.display='inline';resetCountSpan.textContent=10-resetConfirmClicks}else{resetConfirmText.style.display='none';resetConfirmClicks=0;resetCountSpan.textContent='10';resetCanvas()}});exportButton.addEventListener('click',()=>{exportAllCanvases()});importButton.addEventListener('click',()=>{importInput.click()});importInput.addEventListener('change',(event)=>{const file=event.target.files[0];if(!file)return;const reader=new FileReader();reader.onload=function(e){try{const allCanvasStates=JSON.parse(e.target.result);importAllCanvases(allCanvasStates);populateCanvasDropdown();alert('All canvases imported successfully!')}catch(error){console.error('Error importing state:',error);alert('Failed to import canvas states. Invalid file.')}};reader.readAsText(file);importInput.value=''});gridSnapOnButton.addEventListener('click',()=>{setGridSnap(!0)});gridSnapOffButton.addEventListener('click',()=>{setGridSnap(!1)});function setGridSnap(gridSnap){isGridSnap=gridSnap;gridSnapOnButton.classList.toggle('active',isGridSnap);gridSnapOffButton.classList.toggle('active',!isGridSnap);if(!isDarkMode){gridSnapOnButton.classList.add('light-mode');gridSnapOffButton.classList.add('light-mode')}else{gridSnapOnButton.classList.remove('light-mode');gridSnapOffButton.classList.remove('light-mode')}saveCanvasState(currentCanvasName)}function showConfirmationMenu(message,confirmCallback,cancelCallback){confirmationMessage.textContent=message;currentConfirmationCallback=confirmCallback;currentCancelCallback=cancelCallback;confirmationMenu.style.display='flex';if(!isDarkMode){confirmationMenu.classList.add('light-mode')}else{confirmationMenu.classList.remove('light-mode')}}function hideConfirmationMenu(){confirmationMenu.style.display='none';currentConfirmationCallback=null;currentCancelCallback=null}confirmActionButton.addEventListener('click',()=>{if(currentConfirmationCallback){currentConfirmationCallback()}hideConfirmationMenu()});cancelActionButton.addEventListener('click',()=>{if(currentCancelCallback){currentCancelCallback()}hideConfirmationMenu()});function getCanvasList(){const canvasListString=localStorage.getItem(CANVAS_STORAGE_KEY);return canvasListString?JSON.parse(canvasListString):[]}function saveCanvasList(list){localStorage.setItem(CANVAS_STORAGE_KEY,JSON.stringify(list))}function populateCanvasDropdown(){canvasDropdown.innerHTML='';let canvases=getCanvasList().sort();canvases.forEach(canvasName=>{const option=document.createElement('option');option.value=canvasName;option.textContent=canvasName;canvasDropdown.appendChild(option)});canvasDropdown.value=currentCanvasName}function loadCanvas(canvasName){resetCanvasDisplay();currentCanvasName=canvasName;populateCanvasDropdown();const storedState=localStorage.getItem(`nodularNotesCanvas_${canvasName}`);if(storedState){const state=JSON.parse(storedState);setDarkMode(state.darkMode);themeSelect.value=state.theme;setGridSnap(state.gridSnap===undefined?!0:state.gridSnap);canvasOffsetX=state.canvasOffsetX||0;canvasOffsetY=state.canvasOffsetY||0;canvas.style.transform=`translate(${canvasOffsetX}px, ${canvasOffsetY}px)`;const themeChangeEvent=new Event('change');themeSelect.dispatchEvent(themeChangeEvent);state.nodes.forEach(nodeData=>{if(nodeData.type==='text'){createNode(nodeData.left,nodeData.top,nodeData)}else if(nodeData.type==='image'){createImageNode(nodeData.left,nodeData.top,nodeData.imageUrl,nodeData)}})}}function getCanvasState(canvasName){return localStorage.getItem(`nodularNotesCanvas_${canvasName}`)}function saveCanvasState(canvasName){const nodes=[];document.querySelectorAll('.node').forEach(node=>{const nodeData={id:node.id,type:node.classList.contains('image-node')?'image':'text',left:node.offsetLeft,top:node.offsetTop,width:node.offsetWidth,height:node.offsetHeight,};if(nodeData.type==='text'){nodeData.text=node.querySelector('textarea').value}else if(nodeData.type==='image'){nodeData.imageUrl=node.querySelector('img').src;nodeData.aspectRatio=parseFloat(node.dataset.aspectRatio)}nodes.push(nodeData)});const state={darkMode:isDarkMode,theme:themeSelect.value,nodes:nodes,canvasOffsetX:canvasOffsetX,canvasOffsetY:canvasOffsetY,gridSnap:isGridSnap,};localStorage.setItem(`nodularNotesCanvas_${canvasName}`,JSON.stringify(state))}function removeNodeFromState(canvasName,nodeId){const storedState=localStorage.getItem(`nodularNotesCanvas_${canvasName}`);if(storedState){const state=JSON.parse(storedState);state.nodes=state.nodes.filter(node=>node.id!==nodeId);localStorage.setItem(`nodularNotesCanvas_${canvasName}`,JSON.stringify(state))}}function resetCanvasDisplay(){canvasOffsetX=0;canvasOffsetY=0;canvas.style.transform=`translate(0px, 0px)`;document.querySelectorAll('.node').forEach(node=>node.remove())}function resetCanvas(){resetCanvasDisplay();localStorage.removeItem(`nodularNotesCanvas_${currentCanvasName}`);const currentCanvasIndex=getCanvasList().indexOf(currentCanvasName);let updatedCanvasList=getCanvasList();if(currentCanvasIndex>-1){updatedCanvasList.splice(currentCanvasIndex,1)}saveCanvasList(updatedCanvasList);if(updatedCanvasList.length>0){loadCanvas(updatedCanvasList[0])}else{createNewCanvas('Canvas 1')}}function centerCanvas(){const windowWidth=window.innerWidth;const windowHeight=window.innerHeight;canvasOffsetX=(windowWidth-canvasWidth)/2;canvasOffsetY=(windowHeight-canvasHeight)/2;canvas.style.transform=`translate(${canvasOffsetX}px, ${canvasOffsetY}px)`}function createNewCanvas(canvasName){if(!canvasName){let canvasCount=getCanvasList().length+1;canvasName=`Canvas ${canvasCount}`}resetCanvasDisplay();currentCanvasName=canvasName;saveCanvasState(canvasName);saveCanvasList(getCanvasList().concat([canvasName]));populateCanvasDropdown();canvasDropdown.value=canvasName;centerCanvas()}function exportAllCanvases(){const allCanvasStates={};const canvasList=getCanvasList();canvasList.forEach(canvasName=>{const state=getCanvasState(canvasName);if(state){allCanvasStates[canvasName]=JSON.parse(state)}});const blob=new Blob([JSON.stringify(allCanvasStates)],{type:'application/json'});const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download='Noda.json';a.click();URL.revokeObjectURL(url)}function importAllCanvases(canvasStates){const canvasNames=Object.keys(canvasStates);const canvasList=[];canvasNames.forEach(canvasName=>{localStorage.setItem(`nodularNotesCanvas_${canvasName}`,JSON.stringify(canvasStates[canvasName]));canvasList.push(canvasName)});saveCanvasList(canvasList);if(canvasList.length>0){loadCanvas(canvasList[0])}}canvasDropdown.addEventListener('change',(event)=>{loadCanvas(event.target.value)});newCanvasButton.addEventListener('click',()=>{createNewCanvas()});deleteCanvasButton.addEventListener('click',()=>{showConfirmationMenu(`Are you sure you want to delete canvas "${currentCanvasName}"? This cannot be undone.`,resetCanvas,()=>{})});renameCanvasButton.addEventListener('click',()=>{renameCanvasInput.style.display='inline-block';renameCanvasInput.value=currentCanvasName;renameCanvasInput.focus()});renameCanvasInput.addEventListener('blur',()=>{renameCanvasInput.style.display='none'});renameCanvasInput.addEventListener('keydown',(event)=>{if(event.key==='Enter'){const newName=renameCanvasInput.value.trim();if(newName&&newName!==currentCanvasName){let canvasList=getCanvasList();const index=canvasList.indexOf(currentCanvasName);if(index>-1){canvasList[index]=newName}saveCanvasList(canvasList);const currentState=getCanvasState(currentCanvasName);localStorage.removeItem(`nodularNotesCanvas_${currentCanvasName}`);localStorage.setItem(`nodularNotesCanvas_${newName}`,currentState);loadCanvas(newName)}renameCanvasInput.style.display='none'}else if(event.key==='Escape'){renameCanvasInput.style.display='none'}});function initialize(){const prefersDarkMode=window.matchMedia&&window.matchMedia('(prefers-color-scheme: dark)').matches;let initialCanvasList=getCanvasList();if(initialCanvasList.length===0){createNewCanvas('Canvas 1')}else{loadCanvas(initialCanvasList[0]||'Canvas 1')}populateCanvasDropdown();centerCanvas();autoSaveInterval=setInterval(()=>saveCanvasState(currentCanvasName),5000);if(!isDarkMode){canvasDock.classList.add('light-mode');canvasDropdown.classList.add('light-mode');renameCanvasInput.classList.add('light-mode');document.querySelectorAll(".canvas-action-button").forEach(x=>x.classList.add('light-mode'));confirmationMenu.classList.add('light-mode');document.querySelectorAll(".confirmation-button").forEach(x=>x.classList.add('light-mode'));loadingScreen.classList.add('light-mode')}else{canvasDock.classList.remove('light-mode');canvasDropdown.classList.remove('light-mode');renameCanvasInput.classList.remove('light-mode');document.querySelectorAll(".canvas-action-button").forEach(x=>x.classList.remove('light-mode'));confirmationMenu.classList.remove('light-mode');document.querySelectorAll(".confirmation-button").forEach(x=>x.classList.remove('light-mode'));loadingScreen.classList.remove('light-mode')}setTimeout(()=>{loadingScreen.style.opacity='0';setTimeout(()=>{loadingScreen.style.display='none'},1000)},1000)}initialize();saveCanvasState(currentCanvasName)</script></body></html>
